{% for media in page_obj.object_list %}
  <div class="col">
    <div class="card h-100 shadow-sm">
      {# Thumbnail area - click => quick view #}
      <div
        class="ratio ratio-1x1 meme-card-body overflow-hidden"
        data-meme-open
        data-full-url="{{ media.file.url }}"
        data-media-type="{{ media.media_type }}"
        data-detail-url="{% url 'myapp:meme_detail' media.pk %}"
        data-title="{{ media.title|default:'Untitled meme'|escapejs }}"
        data-uploader="{{ media.uploader }}"
        data-created="{{ media.created_at|date:'Y-m-d H:i' }}"
        data-tags='[{% for tag in media.tags.all %}{"name":"{{ tag.name|escapejs }}","url":"?tag={{ tag.slug }}"}{% if not forloop.last %},{% endif %}{% endfor %}]'
      >
        {% if media.media_type == 'image' %}
          <img src="{{ media.file.url }}"
               class="w-100 h-100 object-fit-cover"
               alt="{{ media.title|default:'Meme' }}">
        {% else %}
          <video class="w-100 h-100 object-fit-cover" muted preload="metadata">
            <source src="{{ media.file.url }}">
          </video>
        {% endif %}
      </div>
      <div class="card-body d-flex flex-column meme-card-body">
        <h5 class="card-title text-truncate mb-1">
          {# full detail page still via title click #}
          <a href="{% url 'myapp:meme_detail' media.pk %}"
             class="text-decoration-none">
            {{ media.title|default:"Untitled meme" }}
          </a>
        </h5>
        <p class="text-muted small mb-2">
          {{ media.created_at|date:"Y-m-d H:i" }} Â· by {{ media.uploader }}
        </p>
        <div class="mt-auto">
          {% with tags=media.tags.all %}
            {# show at most 5 tags #}
            {% for tag in tags|slice:":5" %}
              <a href="?tag={{ tag.slug }}"
                 class="badge bg-secondary me-1 mb-1 text-decoration-none">
                #{{ tag.name }}
              </a>
            {% endfor %}
        
            {# if there are more than 5 tags, show "+N" badge #}
            {% if tags|length > 5 %}
              {% with extra=tags|length|add:"-5" %}
              <a href="{% url 'myapp:meme_detail' media.pk %}" class="text-decoration-none">
                <span class="badge bg-secondary mb-1">+{{ extra }}</span>
              </a>
              {% endwith %}
            {% endif %}
          {% endwith %}
        </div>
        
      </div>
    </div>
  </div>
{% endfor %}